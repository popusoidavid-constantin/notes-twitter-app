(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[218],{6907:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/twitter/new",function(){return r(1576)}])},1576:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return n}});var o=r(7458),a=r(2983),l=r(3389);function s(){let[e,t]=(0,a.useState)(null),[r,s]=(0,a.useState)(""),[n,i]=(0,a.useState)(""),[c,d]=(0,a.useState)(null),[u,m]=(0,a.useState)(""),[h,f]=(0,a.useState)(!1),[x,b]=(0,a.useState)(""),[g,p]=(0,a.useState)(""),w=(0,l.useRouter)();(0,a.useEffect)(()=>{let e=async()=>{let e=localStorage.getItem("token");if(!e){p("Not authenticated"),w.push("/");return}try{let r=await fetch("/api/profile/dashboard",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});if(401===r.status){console.log("Token expired, redirecting to login"),localStorage.removeItem("token"),w.push("/");return}let o=await r.json();o.user?t(o.user):(p(o.error||"User not found"),console.error(o.error))}catch(a){console.error("Error fetching user data:",a),p("Failed to authenticate")}};e()},[w]);let j=async t=>{if(t.preventDefault(),b(""),f(!0),!e){b("You must be logged in to create a post"),f(!1);return}if(!r||!n){b("Title and content are required"),f(!1);return}let o="";if(c)try{let a=new FormData;a.append("file",c),a.append("userId",e.id);let l=await fetch("/api/twitter/upload-image",{method:"POST",body:a}),s=await l.json();if(!l.ok){b("Image upload failed: "+(s.error||"")),f(!1);return}o=s.url,console.log("Image uploaded URL:",o)}catch(i){console.error("Upload error:",i),b("Image upload failed"),f(!1);return}try{let d=await fetch("/api/twitter/new",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({title:r,content:n,authorId:e.id,imageUrl:o})}),u=await d.json();d.ok?(console.log("Post created successfully:",u),w.push("/twitter")):b(u.error||"Post creation failed")}catch(m){console.error("Post creation error:",m),b("An error occurred: "+m.message)}finally{f(!1)}};return g?(0,o.jsx)("div",{className:"flex justify-center items-center h-screen bg-[#15202B]",children:(0,o.jsxs)("div",{className:"bg-[#1E2732] p-8 rounded-2xl shadow-lg w-[90%] sm:w-[60%]",children:[(0,o.jsx)("p",{className:"text-red-500 text-center font-medium",children:g}),(0,o.jsx)("button",{onClick:()=>w.push("/"),className:"mt-6 bg-blue-500 text-white py-3 px-6 rounded-lg w-full sm:w-auto hover:bg-blue-600 transition duration-200",children:"Go to Login"})]})}):(0,o.jsx)("div",{className:"flex flex-col justify-center items-center min-h-screen bg-[#15202B]",children:(0,o.jsxs)("div",{className:"bg-[#1E2732] p-8 rounded-2xl shadow-lg w-[90%] sm:w-[60%]",children:[(0,o.jsx)("h2",{className:"text-3xl font-semibold text-center mb-6 text-white",children:"New Post"}),x&&(0,o.jsx)("p",{className:"text-red-500 text-center mb-4",children:x}),(0,o.jsxs)("form",{className:"space-y-6",onSubmit:j,children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-white",children:"Post Title"}),(0,o.jsx)("input",{type:"text",id:"title",name:"title",required:!0,className:"mt-1 block w-full px-4 py-2 bg-[#263340] border border-[#444D56] text-white rounded-md focus:ring-blue-500 focus:border-blue-500",value:r,onChange:e=>s(e.target.value)})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"content",className:"block text-sm font-medium text-white",children:"Post Content"}),(0,o.jsx)("textarea",{id:"content",name:"content",required:!0,className:"mt-1 w-full text-start px-4 py-2 bg-[#263340] border border-[#444D56] text-white rounded-md h-[20vh] focus:ring-blue-500 focus:border-blue-500",value:n,onChange:e=>i(e.target.value)})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"image",className:"block text-sm font-medium text-white",children:"Post Image"}),(0,o.jsx)("input",{type:"file",id:"image",name:"image",accept:"image/*",className:"mt-1 block w-full px-4 py-2 bg-[#263340] border border-[#444D56] text-white rounded-md focus:ring-blue-500 focus:border-blue-500",onChange:e=>{var t;let r=(null===(t=e.target.files)||void 0===t?void 0:t[0])||null;d(r),r&&m(URL.createObjectURL(r))}}),(0,o.jsx)("div",{className:"mt-2 text-sm text-gray-400",children:c?"Selected: ".concat(c.name):u?"Current: ".concat(decodeURIComponent(u.split("/").pop())):"No image selected"}),u&&(0,o.jsx)("img",{src:u,alt:"Preview",className:"mt-4 rounded-lg shadow w-full h-[20vh] object-cover"})]}),(0,o.jsx)("div",{className:"w-full flex flex-col items-center justify-center",children:(0,o.jsx)("button",{type:"submit",className:"w-[40%] bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition duration-200 font-semibold disabled:bg-gray-400",disabled:h,children:h?"Processing...":"Create Post"})})]})]})})}function n(){return(0,o.jsx)(s,{})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=6907)}),_N_E=e.O()}]);