(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[965],{6778:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/twitter/edit/[id]",function(){return r(8229)}])},8229:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var o=r(7458),a=r(2983),s=r(3389),n=r(2058);function l(){let[e,t]=(0,a.useState)(!0),[r,l]=(0,a.useState)(),[i,c]=(0,a.useState)(),[d,u]=(0,a.useState)(""),[m,h]=(0,a.useState)(""),[f,p]=(0,a.useState)(null),[g,x]=(0,a.useState)(""),[b,w]=(0,a.useState)(!1),[y,j]=(0,a.useState)(""),[N,v]=(0,a.useState)(""),S=(0,s.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("token"),r=S.query.id;if(!e||!r)return;let o=async()=>{try{let o=await fetch("/api/twitter/".concat(r),{headers:{Authorization:"Bearer ".concat(e)}}),a=await o.json();o.ok&&a.post?(c(a.post),u(a.post.title),h(a.post.content),x(a.post.imageUrl),t(!1)):j("Failed to fetch post.")}catch(s){console.error(s),j("Error loading post.")}};o()},[S.query.id]),(0,a.useEffect)(()=>{let e=async()=>{let e=localStorage.getItem("token");if(!e){v("Not authenticated"),S.push("/");return}try{let t=await fetch("/api/profile/dashboard",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});if(401===t.status){console.log("Token expired, redirecting to login"),localStorage.removeItem("token"),S.push("/");return}let r=await t.json();r.user?l(r.user):(v(r.error||"User not found"),console.error(r.error))}catch(o){console.error("Error fetching user data:",o),v("Failed to authenticate")}};e()},[S]);let k=async e=>{e.preventDefault(),j(""),w(!0);let t=localStorage.getItem("token"),o=S.query.id,a=null==r?void 0:r.id;if(!d||!m){j("Title and content are required"),w(!1);return}let s="";if(f){let n=new FormData;n.append("file",f),n.append("userId",r.id);let l=await fetch("/api/twitter/upload-image",{method:"POST",body:n}),i=await l.json();if(!l.ok){j("Image upload failed"),w(!1);return}s=i.url}try{let c=await fetch("/api/twitter/edit",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({title:d,content:m,imageUrl:s,authorId:a,postId:o})}),u=await c.json();c.ok?S.push("/twitter"):j(u.error||"Update failed")}catch(h){console.error(h),j("An error occurred")}finally{w(!1)}},E=async e=>{try{await fetch("/api/twitter/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:i.id})}),alert("Note ".concat(i.title," deleted")),S.push("/twitter")}catch(t){console.log("Something went wrong",t)}};return N?(0,o.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,o.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-lg",children:[(0,o.jsx)("p",{className:"text-red-500",children:N}),(0,o.jsx)("button",{onClick:()=>S.push("/"),className:"mt-4 bg-blue-500 text-white py-2 px-4 rounded-lg",children:"Go to Login"})]})}):e?(0,o.jsx)(n.Z,{}):(console.log(f),(0,o.jsx)("div",{className:"flex flex-col justify-center items-center h-screen bg-gray-100",children:(0,o.jsxs)("div",{className:"bg-white p-5 rounded-lg shadow-lg shadow-[#787878] w-[90%] h-[95%] mt-20",children:[(0,o.jsx)("h2",{className:"text-2xl font-semibold text-center mb-3",children:"Edit Post"}),y&&(0,o.jsx)("p",{className:"text-red-500 text-center mb-4",children:y}),(0,o.jsxs)("form",{className:"space-y-4",onSubmit:k,children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Post Title"}),(0,o.jsx)("input",{type:"text",id:"title",name:"title",required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",value:d,onChange:e=>u(e.target.value)})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700",children:"Post Content"}),(0,o.jsx)("textarea",{id:"content",name:"content",required:!0,className:"mt-1 w-full text-start px-3 h-[20vh] py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",value:m,onChange:e=>h(e.target.value)})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"image",className:"block text-sm font-medium text-gray-700",children:"Post Image"}),(0,o.jsx)("input",{type:"file",id:"image",name:"image",accept:"image/*",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",onChange:e=>{var t;let r=(null===(t=e.target.files)||void 0===t?void 0:t[0])||null;p(r),r&&x(URL.createObjectURL(r))}}),(0,o.jsx)("div",{className:"mt-2 text-sm text-gray-600",children:f?"Selected: ".concat(f.name):g?"Current: ".concat(decodeURIComponent(g.split("/").pop())):"No image selected"}),g&&(0,o.jsx)("img",{src:g,alt:"Preview",className:"w-[30%] mt-2 rounded shadow"})]}),(0,o.jsx)("div",{className:"w-full flex flex-col items-center justify-center",children:(0,o.jsx)("button",{type:"submit",className:"w-[20%] bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 focus:outline-none font-semibold disabled:bg-gray-400",disabled:b,children:b?"Updating...":"Update Post"})}),(0,o.jsx)("div",{className:"w-[100%] flex flex-col items-center justify-center",children:(0,o.jsx)("button",{onClick:E,className:"w-[20%] mt-5 bg-red-500 text-white py-2 rounded-lg hover:bg-red-600 focus:outline-none font-semibold",children:"Delete Post"})})]})]})}))}function i(){return(0,o.jsx)(l,{})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=6778)}),_N_E=e.O()}]);